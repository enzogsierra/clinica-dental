<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
    <head th:replace="layout::head">

    </head>

    <body>
        <div class="d-flex flex-column flex-lg-row">
            <header th:replace="layout::header">
                
            </header>
            
            <!-- Contenido -->
            <main class="container-fluid p-4">
                <h2 class="text-center text-lg-start">Información del turno</h2>

                <div class="my-4 p-4 bg-white border rounded-2 shadow-sm">
                    <div class="row row-cols-1 row-cols-xxl-2">
                        <div class="col-12 col-xxl-6">
                            <div class="d-flex justify-content-between">
                                <h3>Datos generales</h3>

                                <div class="text-nowrap">
                                    <button type="button" class="btn btn-sm btn-primary" id="printBtn" th:print-src="@{/turnos/print/{id} (id = ${turno.id})}">
                                        <i class="bi bi-printer-fill"></i>
                                        Imprimir
                                    </button>

                                    <button type="button" class="btn btn-sm btn-warning" th:entity-id="${turno.id}" data-bs-toggle="modal" data-bs-target="#turnoModal" onclick="onEditEntity('/turnos/get', 'Editar turno')">
                                        <i class="bi bi-pencil-square pointer-event-none"></i>
                                    </button>
                                    <button type="button" class="btn btn-sm btn-danger" th:entity-id="${turno.id}" id="deleteEntityBtn" entity-text="Eliminar turno" onclick="onDeleteEntity('/turnos/delete', 'Turno')">
                                        <i class="bi bi-trash pointer-event-none"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="px-4 bg-light border rounded">
                                <div class="py-3 border-bottom">
                                    <div class="row row-cols-2">
                                        <div class="col col-4">Fecha</div>
                                        <div class="col col-auto fw-medium">
                                            <span> 
                                                <span th:text="${#strings.capitalize(#temporals.format(turno.fecha, 'EEEE'))}"></span>,
                                                <span th:text="${#temporals.format(turno.fecha, 'dd')}"></span> de
                                                <span th:text="${#temporals.format(turno.fecha, 'MMMM')}"></span> del
                                                <span th:text="${#temporals.format(turno.fecha, 'yyyy')}"></span>
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <div class="py-3 border-bottom">
                                    <div class="row row-cols-2">
                                        <div class="col col-4">Hora</div>
                                        <div class="col col-auto fw-medium" th:text="${#temporals.format(turno.hora, 'HH:mm')}"></div>
                                    </div>
                                </div>

                                <div class="py-3 border-bottom">
                                    <div class="row row-cols-2">
                                        <div class="col col-4">Paciente</div>
                                        <div class="col col-auto fw-medium">
                                            <a th:href="@{/pacientes/{id} (id = ${turno.paciente.id})}" th:text="${turno.paciente.nombre + ' ' + turno.paciente.apellido}"></a>
                                        </div>
                                    </div>
                                </div>

                                <div class="py-3 border-bottom">
                                    <div class="row row-cols-2">
                                        <div class="col col-4">Doctor</div>
                                        <div class="col col-auto fw-medium" th:text="${turno.doctor.nombre + ' ' + turno.doctor.apellido}"></div>
                                    </div>
                                </div>

                                <div class="py-3 border-bottom">
                                    <div class="row row-cols-2">
                                        <div class="col col-4">Tratamiento</div>
                                        <div class="col col-auto fw-medium" th:text="${turno.tratamiento.nombre}"></div>
                                    </div>
                                </div>

                                <div class="py-3 border-bottom">
                                    <div class="row row-cols-2">
                                        <div class="col col-4">Observaciones</div>
                                        <div th:if="${turno.observaciones.isEmpty()}" class="col col-auto text-muted">(Sin observaciones)</div>
                                        <div th:unless="${turno.observaciones.isEmpty()}" class="col col-auto fw-medium" th:text="${turno.observaciones}"></div>
                                    </div>
                                </div>

                                <div class="py-3">
                                    <div class="row row-cols-2">
                                        <div class="col col-4">Fecha de creación</div>
                                        <div class="col col-auto fw-medium">
                                            <span th:text="${#temporals.format(turno.createdAt, 'dd/MM/yyyy - HH:mm')}"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="mt-3 text-end">
                                
                            </div>
                        </div>

                        <div class="col-12 col-xxl-6">
                            <h3>Estado</h3>
                            
                            <div class="p-4 bg-light border rounded">
                                <div class="d-flex justify-content-evenly align-items-start text-center">
                                    <div>
                                        <p class="fs-5 ls-1 text-muted">Completado</p>
                                        <p class="fs-5 fw-bold text-success" th:if="${turno.completado == true}">Sí</h>
                                        <p class="fs-5 fw-bold" th:unless="${turno.completado == true}">No</h>
                                    </div>

                                    <div>
                                        <p class="fs-5 ls-1 text-muted">Pago</p>
                                        <div th:if="${turno.pago == null}">
                                            <p class="fs-5">No hay pago registrado</p>

                                            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#pagoModal" onclick="onNewEntity('Registrar pago de turno')">Registrar pago</button>
                                        </div>
                                        <div th:unless="${turno.pago == null}">
                                            <a th:href="@{/pagos/{id} (id = ${turno.pago.id})}" class="btn btn-primary">Ver pago</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Modal de entidad -->
                <div class="modal fade" id="turnoModal" tabindex="-1" aria-labelledby="turnoLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4 class="modal-title" id="turnoLabel">Turno</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>

                            <div class="modal-body ui-front">
                                <form method="POST" id="entityForm" onsubmit="onFormSubmit('/turnos/form', 'Turno')">
                                    <div class="mb-3 d-flex gap-2">
                                        <div class="w-100">
                                            <label class="form-label" for="fecha">Fecha *</label>
                                            <input class="form-control" type="date" name="fecha" id="fecha" required>
                                            <div class="invalid-feedback" id="error-fecha"></div>
                                        </div>
                                        <div class="w-100">
                                            <label class="form-label" for="hora">Hora *</label>
                                            <input class="form-control" type="time" name="hora" id="hora" required>
                                            <div class="invalid-feedback" id="error-hora"></div>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label">Paciente (nombre y apellido)</label>

                                        <div class="d-flex gap-2">
                                            <input class="form-control" type="text" id="paciente_nombre" disabled>
                                            <input class="form-control" type="text" id="paciente_apellido" disabled>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label" for="doctor">Doctor *</label>
                                        <select name="doctor" id="doctor" class="form-select" required>
                                            <option value="" disabled selected>-- Seleccionar doctor --</option>
                        
                                            <option
                                                th:each="doctor: ${doctores}"
                                                th:value="${doctor.id}"
                                                th:text="${doctor.nombre + ' ' + doctor.apellido}"
                                            >
                                            </option>
                                        </select>
                                        <div class="invalid-feedback" id="error-doctor"></div>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label" for="tratamiento">Tratamiento</label>
                                        <select name="tratamiento" id="tratamiento" class="form-select">
                                            <option value="0" selected>-- Seleccionar tratamiento --</option>
                        
                                            <option
                                                th:each="tratamiento: ${tratamientos}"
                                                th:value="${tratamiento.id}"
                                                th:text="${tratamiento.nombre}"
                                            >
                                            </option>
                                        </select>
                                        <div class="invalid-feedback" id="error-tratamiento"></div>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label" for="observaciones">Observaciones</label>
                                        <input class="form-control" type="text" name="observaciones" id="observaciones">
                                        <div class="invalid-feedback" id="error-observaciones"></div>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label">Estado del turno</label>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="completado" id="completado">
                                            <label class="form-check-label" for="completado">Completado</label>
                                        </div>
                                        <div class="invalid-feedback" id="error-completado"></div>
                                    </div>
                                
                                    <button type="submit" class="btn btn-primary w-100">Guardar</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div> <!-- /modal -->


                <!-- Modal de pago -->
                <div class="modal fade" id="pagoModal" tabindex="-1" aria-labelledby="pagoLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4 class="modal-title" id="pagoLabel">Pagos</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>

                            <div class="modal-body ui-front">
                                <form method="POST" id="entityForm" onsubmit="onFormSubmit('/pagos/form', 'Pago')">
                                    <input type="number" class="d-none" name="turno" th:value="${turno.id}">
                                    <input type="number" class="d-none" name="paciente" th:value="${turno.paciente.id}">

                                    <div class="mb-3">
                                        <label class="form-label" for="monto">Monto *</label>
                                        <div class="input-group">
                                            <span class="input-group-text">$</span>
                                            <input class="form-control" type="number" name="monto" id="monto" th:value="${turno.tratamiento.precio}" min="0" placeholder="0" required>
                                        </div>
                                        <div class="invalid-feedback" id="error-monto"></div>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label" for="metodoPago">Método de pago *</label>
                                        <select name="metodoPago" id="metodoPago" class="form-select">
                                            <option value="Efectivo" selected>Efectivo</option>
                                            <option value="Tarjeta de crédito">Tarjeta de crédito</option>
                                            <option value="Tarjeta de debito">Tarjeta de debito</option>
                                            <option value="Cheque">Cheque</option>
                                            <option value="Otro">Otro</option>
                                        </select>
                                        <div class="invalid-feedback" id="error-metodoPago"></div>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label">Paciente (emisor del pago)</label>
                                        <input class="form-control" type="text" th:value="${turno.paciente.nombre + ' ' + turno.paciente.apellido}" disabled>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label" for="fechaPago">Fecha del pago *</label>
                                        <input class="form-control" type="date" name="fechaPago" id="fechaPago" th:value="${todayDate}" required>
                                        <div class="invalid-feedback" id="error-fechaPago"></div>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label" for="detalles">Detalles adicionales</label>
                                        <input class="form-control" type="text" name="detalles" id="detalles">
                                        <div class="invalid-feedback" id="error-detalles"></div>
                                    </div>

                                    <button type="submit" class="btn btn-primary w-100">Registrar pago</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div> <!-- /modal -->
            </main>
        </div>

        <!-- Footer & scripts -->
        <footer th:replace="layout::footer"></footer>
        <script th:src="@{/js/entityForm.js}"></script>
        <script th:src="@{/js/print.js}"></script>
    </body>
</html>